# Hash Collision and SHA-256 Collision Resistance

## Hash Collision

해시 충돌이란 서로 다른 값을 hash 했을 때 같은 해시값이 나오는걸 의미한다.

예를들어 어떤 값을 hash 한 결과가 16bit 로 나온다고 하면 2^16=65536 가지 결과가 나오는데, 그럼 65537 가지 서로다른 값으로 hash 하면 반드시 한 쌍의 같은 결과값이 나올 수 밖에 없다.

## Pigeonhole Principle (비둘기집 원리)

n+1 마리의 비둘기가 n 개의 집에 들어갈 경우 최소한 한 집에는 반드시 두 마리 이상의 비둘기가 들어가게 되는 원리.

다만 이는 100% 를 만들기 위한 원리이고 실제로 한 집에 두 마리 이상의 비둘기가 들어갈 확률은 n 보다 훨씬 적은 수에서도 꽤 높은 확률을 가진다. (생일문제)

## Birthday Problem (생일 문제)

어떤 집단에 생일이 같은 사람이 **반드시** 존재하려면 총 몇명이 있어야할까? = 367명

그러면 어떤 집단에 생일이 같은 사람이 존재 할 확률이 50% 가 되려면 몇명? 367/2명? 아님. **23명**.

- 41명에서 90%가 넘어가고
- 57명이면 99%
- 80명이 되면 99.9%가 넘게된다.

이 이유는 인원이 늘어날 때마다 서로 같은 생일이 없을 확률을 계산하기 때문.

대충 2^n 정도의 범위에서 충돌이 30~50% 가 넘게되는 수준은 2^(n/2) 정도이며, 이를 이용해 충돌공격을 시도한다.

## Collision Attack (충돌 공격)

충돌공격은 어떤 해시값에 대해서 해시충돌이 발생하는 다른 값을 찾는 공격이다. (이는 충돌방지를 위해 준비된 알고리즘을 역으로 공격하는 hashDOS 공격에도 쓰일 수 있다.)

위의 생일문제로 인해 실제로 해시 충돌은 만들 수 있는 최대 해시값의 수 보다 훨씬 적은 시도로 공격할 수 있다. 이 생일문제를 이용한 공격보다 더 빠른 공격 알고리즘이 발견 된 해시함수는 "깨졌다" 라고 보고 더이상 사용하지 않는다.

그래서 해시 함수는 충돌저항성이 높게 설계되어야 한다.

## Collision Resistance (충돌 저항성)

해시 함수가 두 개의 서로 다른 입력 값에 대해 동일한 해시 값을 찾아내는 공격을 이론적으로나 실용적으로 어렵게 만든다는 성질. 즉, 공격자가 충돌을 의도적으로 찾아내는 것이 매우 어려운 특성.

현재 충돌저항성이 높은 해시함수중 대표적인 것이 블록체인 네트워크에서도 많이 사용되는 SHA-256이다.

## Collision Resistance of SHA-256

SHA-256은 기본적으로 길이가 매우 길다.

- 특정 해시값을 찾기위해서는 2^256 번 연산을 해야함
- 생일공격을 통해 충돌을 찾으려 해도 2^128 번은 시도 해야함

2^128 번이라는 숫자는 어쨌거나 유한한 수이기 때문에 우연히 겹칠수도 있지만, 확률상 현재 비트코인을 채굴하는 네트워크의 모든 연산력을 동원하더라도 약 2조년 이상의 시간이 지나야 충돌이 한 번 생길까 말까 한 확률을 가진다.

또한 생일공격보다 높은 확률의 공격방법을 방지하기 위해 다음과 같은 방법들을 사용한다:

- 메시지 패딩
- 비트연산
- 메시지블록의 체이닝

이를 통해 예측 가능성을 매우 낮추고 있으므로 안전하다.
